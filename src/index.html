<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keyboard Layout</title>
  <style>
    :root {
      --key-w: 64px;
      --key-h: 64px;
      --gap: 10px;
      --bg: #0c1021;
      --key-bg: #1b2035;
      --key-face: #e4e7ef;
      --accent: #3cc9c7;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Trebuchet MS", "Segoe UI", Tahoma, sans-serif;
    }

    .layout {
      position: relative;
      width: calc(15 * var(--key-w) + 14 * var(--gap));
      height: calc(5 * var(--key-h) + 4 * var(--gap));
      padding: 22px;
      border-radius: 18px;
    }

    .title {
      position: absolute;
      top: -12px;
      left: 18px;
      padding: 6px 12px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), #5de4c7);
      color: #081018;
      font-weight: 700;
      letter-spacing: 0.08em;
    }

    .key {
      position: absolute;
      width: calc(var(--key-w) * var(--w, 1) + var(--gap) * (var(--w, 1) - 1));
      height: var(--key-h);
      left: calc(var(--col) * (var(--key-w) + var(--gap)));
      top: calc(var(--row) * (var(--key-h) + var(--gap)));
      border-radius: 10px;
      background: linear-gradient(155deg, #20263b, #0f1325);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
      color: var(--key-face);
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.35);
    }

    .key.function {
      color: #cfd5ee;
      background: linear-gradient(160deg, #1e273a, #0f1527);
    }

    .key.action {
      background: linear-gradient(160deg, #234443, #132929);
      color: #e8fffb;
    }

    .key.space {
      justify-content: flex-start;
      padding-left: 20px;
    }
    .key.pressed {
      background: linear-gradient(160deg, #3cc9c7, #5de4c7);
      color: #081018;
    }
  </style>
</head>

<body>
  <div class="layout">
    <!--<div class="title">QWERTY</div>-->

    <!-- Row 1 -->
    <div class="key function" data-key="Escape" style="--row: 0; --col: 0">Esc</div>
    <div class="key" data-key="Digit1" style="--row: 0; --col: 1">1</div>
    <div class="key" data-key="Digit2" style="--row: 0; --col: 2">2</div>
    <div class="key" data-key="Digit3" style="--row: 0; --col: 3">3</div>
    <div class="key" data-key="Digit4" style="--row: 0; --col: 4">4</div>
    <div class="key" data-key="Digit5" style="--row: 0; --col: 5">5</div>
    <div class="key" data-key="Digit6" style="--row: 0; --col: 6">6</div>
    <div class="key" data-key="Digit7" style="--row: 0; --col: 7">7</div>
    <div class="key" data-key="Digit8" style="--row: 0; --col: 8">8</div>
    <div class="key" data-key="Digit9" style="--row: 0; --col: 9">9</div>
    <div class="key" data-key="Digit0" style="--row: 0; --col: 10">0</div>
    <div class="key" data-key="Minus" style="--row: 0; --col: 11">-</div>
    <div class="key" data-key="Equal" style="--row: 0; --col: 12">=</div>
    <div class="key action" data-key="Backspace" style="--row: 0; --col: 13; --w: 2">Backspace</div>

    <!-- Row 2 -->
    <div class="key action" data-key="Tab" style="--row: 1; --col: 0; --w: 1.5">Tab</div>
    <div class="key" data-key="KeyQ" style="--row: 1; --col: 1.5">Q</div>
    <div class="key" data-key="KeyW" style="--row: 1; --col: 2.5">W</div>
    <div class="key" data-key="KeyE" style="--row: 1; --col: 3.5">E</div>
    <div class="key active" data-key="KeyR" style="--row: 1; --col: 4.5">R</div>
    <div class="key" data-key="KeyT" style="--row: 1; --col: 5.5">T</div>
    <div class="key" data-key="KeyY" style="--row: 1; --col: 6.5">Y</div>
    <div class="key" data-key="KeyU" style="--row: 1; --col: 7.5">U</div>
    <div class="key" data-key="KeyI" style="--row: 1; --col: 8.5">I</div>
    <div class="key" data-key="KeyO" style="--row: 1; --col: 9.5">O</div>
    <div class="key" data-key="KeyP" style="--row: 1; --col: 10.5">P</div>
    <div class="key" data-key="BracketLeft" style="--row: 1; --col: 11.5">[</div>
    <div class="key" data-key="BracketRight" style="--row: 1; --col: 12.5">]</div>
    <div class="key action" data-key="Backslash" style="--row: 1; --col: 13.5; --w: 1.5">\</div>

    <!-- Row 3 -->
    <div class="key action" data-key="CapsLock" style="--row: 2; --col: 0; --w: 1.8">Caps</div>
    <div class="key" data-key="KeyA" style="--row: 2; --col: 1.8">A</div>
    <div class="key" data-key="KeyS" style="--row: 2; --col: 2.8">S</div>
    <div class="key" data-key="KeyD" style="--row: 2; --col: 3.8">D</div>
    <div class="key" data-key="KeyF" style="--row: 2; --col: 4.8">F</div>
    <div class="key" data-key="KeyG" style="--row: 2; --col: 5.8">G</div>
    <div class="key" data-key="KeyH" style="--row: 2; --col: 6.8">H</div>
    <div class="key" data-key="KeyJ" style="--row: 2; --col: 7.8">J</div>
    <div class="key" data-key="KeyK" style="--row: 2; --col: 8.8">K</div>
    <div class="key" data-key="KeyL" style="--row: 2; --col: 9.8">L</div>
    <div class="key" data-key="Semicolon" style="--row: 2; --col: 10.8">;</div>
    <div class="key" data-key="Quote" style="--row: 2; --col: 11.8">'</div>
    <div id="enterKey" class="key action" data-key="Enter" style="--row: 2; --col: 12.8; --w: 2.2">Enter</div>

    <!-- Row 4 -->
    <div class="key action" data-key="Shift" style="--row: 3; --col: 0; --w: 2.3">Shift</div>
    <div class="key" data-key="KeyZ" style="--row: 3; --col: 2.3">Z</div>
    <div class="key" data-key="KeyX" style="--row: 3; --col: 3.3">X</div>
    <div class="key" data-key="KeyC" style="--row: 3; --col: 4.3">C</div>
    <div class="key" data-key="KeyV" style="--row: 3; --col: 5.3">V</div>
    <div class="key" data-key="KeyB" style="--row: 3; --col: 6.3">B</div>
    <div class="key" data-key="KeyN" style="--row: 3; --col: 7.3">N</div>
    <div class="key" data-key="KeyM" style="--row: 3; --col: 8.3">M</div>
    <div class="key" data-key="Comma" style="--row: 3; --col: 9.3">,</div>
    <div class="key" data-key="Period" style="--row: 3; --col: 10.3">.</div>
    <div class="key" data-key="Slash" style="--row: 3; --col: 11.3">/</div>
    <div class="key action" data-key="Shift" style="--row: 3; --col: 12.3; --w: 2.7">Shift</div>

    <!-- Row 5 -->
    <div class="key action" data-key="Control" style="--row: 4; --col: 0; --w: 1.5">Ctrl</div>
    <div class="key action" data-key="Meta" style="--row: 4; --col: 1.5; --w: 1.2">Win</div>
    <div class="key action" data-key="Alt" style="--row: 4; --col: 2.7; --w: 1.3">Alt</div>
    <div class="key action space" data-key="Space" style="--row: 4; --col: 4; --w: 6">Space</div>
    <div class="key action" data-key="Alt" style="--row: 4; --col: 10; --w: 1.3">Alt</div>
    <div class="key action" data-key="Fn" style="--row: 4; --col: 11.3; --w: 1.1">Fn</div>
    <div class="key action" data-key="ContextMenu" style="--row: 4; --col: 12.4; --w: 1.3">Menu</div>
    <div class="key action" data-key="Control" style="--row: 4; --col: 13.7; --w: 1.5">Ctrl</div>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
    const tauri = window.__TAURI__;
    if (!tauri) {
      console.error("Tauri global API (window.__TAURI__) is not available");
      return;
    }

    // 1. Стартуем фоновый Rust-слушатель
    tauri.core
      .invoke("start_keyboard_listener")
      .catch((err) => console.error("Failed to start listener:", err));
    
    // 2. Слушаем события key_event из Rust
    tauri.event
      .listen("key_event", (e) => {
        const { key, event_type } = e.payload;
        handleKey(key, event_type);
      })
      .catch((err) => console.error("Failed to listen key_event:", err));
  });

  function handleKey(code, type) {
    console.log(`Key: ${code}, Type: ${type}`);
    // Ищем по data-key — это надёжно

    const el = document.querySelector(`.key[data-key="${code}"]`);
    if (!el) return;

    if (type === "down") {
      el.classList.add("pressed");
    } else if (type === "up") {
      el.classList.remove("pressed");
    }
  }
  </script>
</body>

</html>
